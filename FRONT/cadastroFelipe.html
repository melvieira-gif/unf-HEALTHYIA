<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro - Health-IA</title>
  <link href="https:cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="cadastroCSS.css">
</head>

<body>
  <div class="container">

    <div class="login-container">

      <img src="HealthIA.png" alt="Health-IA Logo" class="logo">
      <h1 class="title">Cadastro</h1>

      <form action="http://localhost:3000/cadastro_login" method="POST" class="form">

        <div class="input-group">
          <label for="nome_user">Nome Completo</label>
          <input type="text" id="nome_user" name="nome_user" required placeholder="Digite seu nome completo">
        </div>

        <div class="input-group">
          <label for="email">E-mail Corporativo</label>
          <input type="email" id="email_user" name="email" required placeholder="Digite seu e-mail">
        </div>

        <div class="input-group">
          <label for="dt_nasc">Data de Nascimento</label>
          <input type="date" id="dt_nasc_user" name="dt_nasc" required>
        </div>

        <div class="input-group">
          <label for="senha">Senha</label>
          <input type="password" id="senha_user" name="senha" required placeholder="Digite sua senha">
        </div>

        <button type="submit" class="btn" id="btn_salvar_cadastro">Cadastrar</button>
      </form>
      <div id="feedback" class="mt-3"></div>

      <a href="login.html" class="link">Já tem uma conta?</a>

      <div class="footer">
        <p>© 2025 Health-IA</p>
      </div>

    </div>
  </div>
</body>

<script>
  //Criando evento ao clicar no botão de Cadastrar-se
  const form = document.querySelector('form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    console.log("Enviou os dados!")
     //Req para o backend
    try {
        const dados = await resposta.json();
        const feedback = document.getElementById("feedback");
       //Limpa o meu card que estava antes
        feedback.innerHTML = "";

       //Em caso de erro no meu backend
        if (!resposta.ok || dados.resposta?.toLowerCase().includes("erro") || dados.resposta?.toLowerCase().includes("insira") || dados.resposta?.toLowerCase().includes("deve")) {
            feedback.innerHTML=`
            <div class= "alert alert-danger" role="alert">
            ${dados.resposta}
            </div>
            `;
            return;  
       }
       //Caso de um success
       feedback.innerHTML = `
       <div class="alert alert-success" role="alert">
         ${dados.resposta}
       </div>
       `;
    }catch (error) {
        console.log(error)
        const feedback = document.getElementById("feedback");
        feedback.innerHTML = `
        <div class="alert alert-danger" role="alert">
            Erro ao se conectar ao servidor.
        </div>
        `;
    }
    
    document.getElementById("btn_salvar_cadastro").addEventListener("click", async ()=>{
        // primeira etapa- pegar as informaçoes dos inputs 
        const nome_user = document.getElementById("nome_user").value
        const email_user = document.getElementById("email_user").value
        const senha_user = document.getElementById("senha_user").value
        const dt_nasc_user = document.getElementById("dt_nasc_user").value

        // segunda etapa- fazer a requisição para o back-end o que o thunder client não mostra oq faz
        // fetch funciona pq vai passar o endereço da requisição
        const resposta = await fetch (`http://localhost:3000/cadastro_login`,{
            method:"POST",
            headers:{
                "Accept":"application/json",
                "Content-Type":"application/json" // o tipo de conteudo que estou mandando é o JSON
            },
            body:JSON.stringify({
                "nome_user":nome_user,
                "email_user":email_user,
                "senha_user":senha_user,
                "dt_nasc_user":dt_nasc_user})
        })
        // terceira etapa - pegar a resposta do back-end
        if(resposta.ok){
            const dados = await resposta.json()
            document.getElementById("resultado_cadastro").innerHTML = dados.resposta
        }else{

        }
    })
  });
</script>

</html>